<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="author" content="Hamid Ebadi" /><link rel="canonical" href="https://infotiv-research.github.io/SIMLAN/simulation/visualize_real_data/" />
      <link rel="shortcut icon" href="../../img/favicon.ico" />
    <title>Visualize Real Data Package - SIMLAN, Simulation for Multi-Camera Robotics</title>
    <link rel="stylesheet" href="../../css/theme.css" />
    <link rel="stylesheet" href="../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Visualize Real Data Package";
        var mkdocs_page_input_path = "simulation/visualize_real_data/README.md";
        var mkdocs_page_url = "/SIMLAN/simulation/visualize_real_data/";
      </script>
    
    <!--[if lt IE 9]>
      <script src="../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/bash.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/python.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../.." class="icon icon-home"> SIMLAN, Simulation for Multi-Camera Robotics
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../..">SIMLAN, Vision-Based Multi-Camera Robotics Simulation</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../dependencies/">Dependencies</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../contributing/">Contributing</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../config_generation/">Config Generation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Simulation</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="../">Simulation</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../simlan_gazebo_environment/worlds/">Gazebo Worlds</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../raw_models/">Models</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../raw_models/objects/">Object Modeling</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../raw_models/warehouse/">Warehouse Specification</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../simlan_bringup/">SIMLAN Bringup</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../static_agent_launcher/">GPSS cameras</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../camera_bird_eye_view/">Camera Bird Eye View</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../aruco_localization/">Aruco Localization</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../pallet_truck/pallet_truck_bringup/">Bringup</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../pallet_truck/">Pallet Truck</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../pallet_truck/pallet_truck_control/">Control</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../pallet_truck/pallet_truck_navigation/">Navigation</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../bt_failsafe/">Failsafe</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../humanoid_robot/">Humanoid Robot</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../humanoid_support_moveit_config/">Humanoid Moveit</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../humanoid_utility/">Humanoid Motion Capture</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../humanoid_utility/pre_processing/">Humanoid Preprocessing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../humanoid_utility/DEBUG/">Humanoid internal</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../humanoid_motion_planner/">Humanoid motion planner</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../humanoid_utility/pose_to_motion/autogluon/">Pose to Motion AutoGluon model</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../robot_arm_moveit2/">Panda MoveIt2</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../object_mover/">Object Mover</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../scenario_manager/">Scenario Manager</a>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" href="./">Visualize Real Data Package</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#preparing-data">Preparing Data</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#build-the-package">Build the package</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#add-the-data">Add the data</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#config-file">Config file</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#paramsyaml-overview">params.yaml Overview</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#prepare_data-section">prepare_data section:</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#send_data-section">send_data section:</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#scenario_replayer-section">scenario_replayer section:</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#shared-section">shared section:</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#launching-the-processing-step">Launching the Processing Step</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#sending-data">Sending Data</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#adjusting-playback-speed">Adjusting Playback Speed</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#fixing-rviz">Fixing RViz</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#summary">Summary</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#warnings-and-errors-from-the-node">Warnings and Errors from the node</a>
    </li>
        </ul>
    </li>
    </ul>
                  </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../credits/">Credits</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Appendix</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../ISSUES/">Issues</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../CHANGELOG/">Changelog</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../resources/diagrams/">Diagrams</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../..">SIMLAN, Simulation for Multi-Camera Robotics</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../.." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">Simulation</li>
      <li class="breadcrumb-item active">Visualize Real Data Package</li>
    <li class="wy-breadcrumbs-aside">
          <a href="https://github.com/infotiv-research/SIMLAN/edit/master/docs/simulation/visualize_real_data/README.md">Edit on infotiv-research/SIMLAN</a>
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="visualize-real-data-package">Visualize Real Data Package</h1>
<p>The <code>visualize_real_data</code> package is designed to replay and visualize real-world trajectory data within RViz and Gazebo. This package takes recorded trajectory data (in JSON format) and corresponding images, processes them into ROS-compatible formats, and enables visualization and simulation replay in Gazebo.</p>
<h2 id="preparing-data">Preparing Data</h2>
<p>Before replaying any data, it has to be recorded. This is done by performing the steps below.</p>
<h3 id="build-the-package">Build the package</h3>
<p>First the package needs to be built, if this is not already done run:</p>
<pre><code class="language-bash">./control.sh build
</code></pre>
<h3 id="add-the-data">Add the data</h3>
<p>Add your data files beneath the <code>simulation/replay_data</code> directory. Your structure should look like this:</p>
<pre><code class="language-bash">replay_data/
|── images/
|   |── images
|   |── 1770030000000.jpg #Example image 1
|   |── 1770030000100.jpg #Example image 2
|── example_trajectory.json # Example using image 1 and 2.
|── README.md
</code></pre>
<p>By default, the package expects to find the trajectory data inside the <code>replay_data/</code> folder as <code>.json</code>, and the images inside the <code>images/</code> folder as <code>.jpg</code>. The .json trajectories are expected on this form:</p>
<pre><code class="language-json">{
  &quot;time_stamp&quot;: 1770030000000, // Unix timestamp in milliseconds
  &quot;object_list&quot;: [
    [
      0, // Tracking ID
      1, // X
      2, // Y
      3, // Z (most often 0)
      4 // Orientation (does not have to be included, this is what is generated by orientation_faker)
    ],
    //...
  ]
}
</code></pre>
<p>Some things to note:</p>
<ul>
<li>
<p>The <code>replay_data</code> folder is gitignored, so you can safely save images there without uploading to git.</p>
</li>
<li>
<p>The <strong>folder-names are configurable</strong>, as long as the settings in <code>params.yaml</code> match.</p>
</li>
<li>
<p>You can:</p>
</li>
<li>
<p>Rename the <code>images/</code> folder to something else.</p>
</li>
<li>
<p>Rename the trajectory JSON file to any other valid filename.</p>
</li>
<li>
<p>Just be sure to update the corresponding fields (<code>images_folder</code>, <code>json_file_name</code>) in <code>params.yaml</code>.</p>
</li>
</ul>
<h2 id="config-file">Config file</h2>
<p>When your data is in place, you may want to review the config parameters in <code>params.yaml</code>. This step is often optional, as default settings typically work well. There is currently an example trajectory file that will show an image of a dog and a cat (these would be your stitched images in practice) and with the positions from the trajectories as visualization markers. These are mostly there to check that things still work as intended without the need of external data.</p>
<h3 id="paramsyaml-overview"><code>params.yaml</code> Overview</h3>
<h4 id="prepare_data-section"><code>prepare_data</code> section:</h4>
<ul>
<li>The parameters here have to be set before <code>prepare.launch.py</code> is run. Changes made afterwards will not affect the preparation process (image-&gt;PointCloud2).</li>
</ul>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Default Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>pointcloud_topic</code></td>
<td>Topic to publish the <code>PointCloud2</code> (image data).</td>
<td><code>pointcloud_topic</code></td>
</tr>
<tr>
<td><code>images_folder</code></td>
<td>Name of the folder containing images.</td>
<td><code>images</code></td>
</tr>
<tr>
<td><code>image_scale</code></td>
<td>Resize factor for <code>.jpg</code> images (useful for RViz display).</td>
<td><code>0.04</code></td>
</tr>
<tr>
<td><code>set_frames</code></td>
<td>If <code>true</code>, limits processing to <code>frames_to_process</code>; otherwise, all available images will be used.</td>
<td><code>false</code></td>
</tr>
<tr>
<td><code>frames_to_process</code></td>
<td>Number of frames to process if <code>set_frames</code> is <code>true</code>.</td>
<td><code>1</code></td>
</tr>
<tr>
<td><code>preprocess_all_data</code></td>
<td>If <code>true</code>, preprocesses all available data before playback. May not work for extremely large recording windows.</td>
<td><code>true</code></td>
</tr>
<tr>
<td><code>fake_orientation</code></td>
<td>If <code>true</code>, automatically fakes object orientations during data preparation (used by the scenario replayer).</td>
<td><code>true</code></td>
</tr>
<tr>
<td><code>list_json_files</code></td>
<td>If <code>true</code>, lists available JSON files in the replay_data directory during preparation.</td>
<td><code>false</code></td>
</tr>
</tbody>
</table>
<h4 id="send_data-section"><code>send_data</code> section:</h4>
<ul>
<li>Parameters here can be changed after the prepare-stage to alter the playback.
  <em>You do not need to rebuild the package or re-run prepare.launch.py</em> if you change something here.</li>
</ul>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Default Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>playback_rate</code></td>
<td>Controls playback speed. Default is <code>1</code> (real-time based on <code>extracted_fps</code>).</td>
<td><code>1</code></td>
</tr>
<tr>
<td><code>bag_name</code></td>
<td>Name of the rosbag to play. If empty, the most recent one is used.</td>
<td><em>(empty)</em></td>
</tr>
</tbody>
</table>
<h4 id="scenario_replayer-section"><code>scenario_replayer</code> section:</h4>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Default Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>gazebo_teleport_service</code></td>
<td>Service name for teleporting robots in Gazebo.</td>
<td><code>/world/default/set_pose</code></td>
</tr>
<tr>
<td><code>frame_id</code></td>
<td>Frame in which entities are visualized.</td>
<td><code>real_data</code></td>
</tr>
<tr>
<td><code>use_cmd_vel</code></td>
<td>If <code>true</code>, robots are driven with velocity commands; otherwise, teleportation is used to reenact the scenario. When set to <code>true</code>, it is important the simulation runs close to 100% real-time.</td>
<td><code>false</code></td>
</tr>
<tr>
<td><code>ignore_orientation</code></td>
<td>If <code>true</code>, robot orientation is reset to identity (no rotation) regardless of source data. Using with <code>cmd_vel</code> may cause unexpected movement behavior.</td>
<td><code>false</code></td>
</tr>
</tbody>
</table>
<h4 id="shared-section"><code>shared</code> section:</h4>
<ul>
<li>Parameters here have to be set at the prepare-stage and can't be changed afterwards.</li>
</ul>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Default Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>frame_id</code></td>
<td>Name of the frame in which all data is displayed.</td>
<td><code>real_data</code></td>
</tr>
<tr>
<td><code>namespace</code></td>
<td>Namespace used for the node.</td>
<td><code>visualize_real_data</code></td>
</tr>
<tr>
<td><code>entity_topic</code></td>
<td>Topic to publish the <code>MarkerArray</code> (trajectory data).</td>
<td><code>entity_topic</code></td>
</tr>
<tr>
<td><code>json_file_name</code></td>
<td>Name of the file containing trajectory data.</td>
<td><code>example_trajectory.json</code></td>
</tr>
<tr>
<td><code>start_time</code></td>
<td>Start time for data processing (optional filter).</td>
<td><code>""</code></td>
</tr>
<tr>
<td><code>end_time</code></td>
<td>End time for data processing (optional filter).</td>
<td><code>""</code></td>
</tr>
<tr>
<td><code>initial_heading</code></td>
<td>Initial heading/orientation in degrees (0 = pointing left). Used by orientation_faker.</td>
<td><code>0.0</code></td>
</tr>
<tr>
<td><code>frame_position</code></td>
<td><code>x</code>,<code>y</code>,<code>z</code> coordinates for visualization frame.</td>
<td><code>x: 15.35, y: 5.7, z: -0.2</code></td>
</tr>
<tr>
<td><code>extracted_fps</code></td>
<td>FPS of the extracted data for playback.</td>
<td><code>10.0</code></td>
</tr>
<tr>
<td><code>processing_time_limit</code></td>
<td>Max time allowed per frame for consistent playback. If exceeded, a warning appears.</td>
<td><code>0.8</code></td>
</tr>
</tbody>
</table>
<h3 id="launching-the-processing-step">Launching the Processing Step</h3>
<p>Once configured, first run:</p>
<pre><code class="language-bash">./control.sh replay_sim
</code></pre>
<p>This starts the simulation with the correct rviz config.</p>
<p>Then run either:</p>
<pre><code class="language-bash">ros2 launch visualize_real_data prepare.launch.py
</code></pre>
<p>or</p>
<pre><code class="language-bash">./control.sh prepare
</code></pre>
<p>This will first start the <code>orientation_faker</code> node, which adds an orientation to the data based on the angle between points in the trajectory (this step can be ignored by changing the <code>fake_orientation</code> parameter). Afterwards, the data processing is started and generates a rosbag file stored in a <code>rosbags/</code> folder inside the <code>replay_data</code> directory.</p>
<blockquote>
<p><strong>NOTE:</strong> If orientation is already given, change the <code>fake_orientation</code> parameter inside the config to prevent it from overwriting the data.</p>
</blockquote>
<ul>
<li>Rosbags are named using the name of the JSON file used and timestamps (e.g., <code>my_recording_20250722_153045</code> if the JSON file is named <code>my_recording.json</code>).</li>
<li>Existing rosbags <strong>are never overwritten</strong>.</li>
<li>You can delete old rosbags manually from the <code>rosbags/</code> folder if needed.</li>
</ul>
<h2 id="sending-data">Sending Data</h2>
<p>After processing the data, you can send it to RViz:</p>
<ol>
<li>
<p>Make sure you’ve added the following displays to RViz:</p>
</li>
<li>
<p><code>PointCloud2</code></p>
</li>
<li>
<p><code>MarkerArray</code></p>
</li>
<li>
<p>Run:</p>
</li>
</ol>
<pre><code class="language-bash">ros2 launch visualize_real_data send.launch.py
</code></pre>
<p>or</p>
<pre><code class="language-bash">./control.sh replay_rviz
</code></pre>
<p>This command sends the most <strong>recently created rosbag</strong> to the topics defined in <code>params.yaml</code>.</p>
<ul>
<li>To play an earlier dataset, you must manually delete newer rosbags as the latest one (by timestamp) is always selected automatically.</li>
</ul>
<h3 id="adjusting-playback-speed">Adjusting Playback Speed</h3>
<p>You can modify the <code>playback_rate</code> parameter in <code>params.yaml</code> to control how quickly the rosbag is replayed.</p>
<ul>
<li>A value of <code>1</code> reflects real-time playback based on extracted timestamps.</li>
<li>Slower or faster playback is supported, but <em>extreme values haven't been tested</em>.</li>
</ul>
<h3 id="fixing-rviz">Fixing RViz</h3>
<ul>
<li>
<p>Usually the displays in RViz have to be configured to subscribe to the correct topics, and the PointCloud2 display's size has to match the image_scale defined in the <code>params.yaml</code> config file to look right.</p>
</li>
<li>
<p>You can also change <code>Alpha</code> in the PointCloud display to see through the image.</p>
</li>
<li>
<p>If the images aren't showing up, sometimes the <code>QOS (Quality of Service)</code> settings might be mismatched between the <code>rosbag player</code> and <code>RViz</code>.
  The intended <code>QOS settings</code> can be found in the <code>recorder_qos.yaml</code> file in the <code>config</code> folder together with the <code>params.yaml</code> file.
  These are the settings that the rosbag player uses, and the easiest fix is to make sure that RViz mirrors these settings for the respective displays.</p>
</li>
</ul>
<h2 id="summary">Summary</h2>
<ol>
<li>Build package using <code>CTRL + SHIFT + B</code> VS Code task.</li>
<li>Add the data you want to show in RViz in the <code>replay_data</code> folder</li>
<li>Configure parameters under 'prepare_data', 'shared', and/or 'scenario_replayer' <em>(optional)</em></li>
<li>Run <code>prepare.launch.py</code></li>
<li>Open RViz2 and add the displays <code>PointCloud2</code> and <code>MarkerArray</code></li>
<li>Make sure the QOS-settings match between the rosbag player and the displays</li>
<li>Configure parameters under 'send_data' <em>(optional)</em></li>
<li>Run <code>send.launch.py</code></li>
<li>Subscribe to the relevant topics (as defined in <code>params.yaml</code>) in RViz2</li>
</ol>
<p>Now the data should be visualized.</p>
<h3 id="warnings-and-errors-from-the-node">Warnings and Errors from the node</h3>
<p>Warnings and Errors thrown by this package are intended to inform you when something unexpected occurs during execution. In most cases, the process can continue without interruption, although the output may be affected.</p>
<p>It is strongly recommended to resolve the underlying issue based on the warning/error message and then <strong>re-run the process</strong> to ensure reliable and consistent output.</p>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../scenario_manager/" class="btn btn-neutral float-left" title="Scenario Manager"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../../credits/" class="btn btn-neutral float-right" title="Credits">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../scenario_manager/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../../credits/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "../..";</script>
    <script src="../../js/theme_extra.js"></script>
    <script src="../../js/theme.js"></script>
      <script src="../../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
