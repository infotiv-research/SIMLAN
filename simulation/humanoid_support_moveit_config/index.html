<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="author" content="Hamid Ebadi" /><link rel="canonical" href="https://infotiv-research.github.io/SIMLAN/simulation/humanoid_support_moveit_config/" />
      <link rel="shortcut icon" href="../../img/favicon.ico" />
    <title>Humanoid Moveit - SIMLAN, Simulation for Multi-Camera Robotics</title>
    <link rel="stylesheet" href="../../css/theme.css" />
    <link rel="stylesheet" href="../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Humanoid Moveit";
        var mkdocs_page_input_path = "simulation/humanoid_support_moveit_config/README.md";
        var mkdocs_page_url = "/SIMLAN/simulation/humanoid_support_moveit_config/";
      </script>
    
    <!--[if lt IE 9]>
      <script src="../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/bash.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/python.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../.." class="icon icon-home"> SIMLAN, Simulation for Multi-Camera Robotics
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../..">SIMLAN, Vision-Based Multi-Camera Robotics Simulation</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../dependencies/">Dependencies</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../contributing/">Contributing</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../config_generation/">Config Generation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Simulation</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="../">Simulation</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../simlan_gazebo_environment/worlds/">Gazebo Worlds</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../raw_models/">Models</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../raw_models/objects/">Object Modeling</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../raw_models/warehouse/">Warehouse Specification</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../simlan_bringup/">SIMLAN Bringup</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../static_agent_launcher/">GPSS cameras</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../camera_bird_eye_view/">Camera Bird Eye View</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../aruco_localization/">Aruco Localization</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../pallet_truck/pallet_truck_bringup/">Bringup</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../pallet_truck/">Pallet Truck</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../pallet_truck/pallet_truck_control/">Control</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../pallet_truck/pallet_truck_navigation/">Navigation</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../bt_failsafe/">Failsafe</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../humanoid_robot/">Humanoid Robot</a>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" href="./">Humanoid Moveit</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#moveit">Moveit</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#dynamically-updated-urdfs">Dynamically updated URDFs</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#planning-scene-monitor">Planning scene monitor</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#figures">Figures</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#rviz2-visualization">Rviz2 visualization</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#bugs-tf-visualization-and-gazebo-simulation-not-matching">Bugs: TF visualization and Gazebo simulation not matching</a>
    </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../humanoid_utility/">Humanoid Motion Capture</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../humanoid_utility/pre_processing/">Humanoid Preprocessing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../humanoid_utility/DEBUG/">Humanoid internal</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../humanoid_motion_planner/">Humanoid motion planner</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../humanoid_utility/pose_to_motion/autogluon/">Pose to Motion AutoGluon model</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../robot_arm_moveit2/">Panda MoveIt2</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../object_mover/">Object Mover</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../scenario_manager/">Scenario Manager</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../visualize_real_data/">Visualize Real Data Package</a>
                  </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../credits/">Credits</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Appendix</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../ISSUES/">Issues</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../CHANGELOG/">Changelog</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../resources/diagrams/">Diagrams</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../..">SIMLAN, Simulation for Multi-Camera Robotics</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../.." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">Simulation</li>
      <li class="breadcrumb-item active">Humanoid Moveit</li>
    <li class="wy-breadcrumbs-aside">
          <a href="https://github.com/infotiv-research/SIMLAN/edit/master/docs/simulation/humanoid_support_moveit_config/README.md">Edit on infotiv-research/SIMLAN</a>
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="humanoid">Humanoid</h1>
<p>In this file, the basics of the humanoid structure will be described. In the future, all nodes will be namespaced to add the functionality of spawning and controlling multiple humanoids.</p>
<h2 id="moveit">Moveit</h2>
<p>For MoveIt to work, 3 components must have correct information:</p>
<ul>
<li>URDF link names</li>
<li>SRDF joint definitions</li>
<li>TF frames published by robot_state_publisher</li>
</ul>
<p>There was an issue when trying to add namespaces to the humanoid project. Since the humanoid is made of 40+ links, it was decided to add the <code>"frame_prefix": f"{namespace}"</code> in the robot_state_publisher node. This, however, made a conflict since the URDF, SRDF, and TF frames no longer matched. This was solved by adding <code>base_link</code> in between the world and namespace/base_link frames and creating a static transform between them. <strong>This means that all further humanoids will be spawned under the <code>base_link</code> frame.</strong> (otherwise, the warning below again appears)</p>
<h2 id="dynamically-updated-urdfs">Dynamically updated URDFs</h2>
<p>To make the multiple_humanoid_spawn work, we need to be able to launch different namespaces in the robot_description. This is done by running:</p>
<pre><code class="language-python">moveit_config = (
    MoveItConfigsBuilder(&quot;human_support&quot;, package_name=&quot;humanoid_support_moveit_config&quot;)
    .robot_description(
        file_path=&quot;config/human_support.urdf.xacro&quot;, mappings={&quot;namespace&quot;: namespace}
    )
    .to_moveit_configs()
)
</code></pre>
<p>This updates the <code>namespace</code> argument inside the .xacro files.</p>
<h2 id="planning-scene-monitor">Planning scene monitor</h2>
<p>When working with the MoveIt package, some bugs or undesired features were found. When MoveIt is launched, the PlanningSceneMonitor and PlanningFrame subscribe to all TF frames that exist and assume they can transform any known object or sensor data into its planning frame, which is <code>base_link</code> in this case. If this cannot be done, it will throw a warning saying the following:</p>
<pre><code>[WARN] [humanoid.moveit.moveit.ros.planning_scene_monitor] [id]: Unable to transform object from frame 'unconnected_frame' to planning frame 'base_link' (Could not find a connection between 'base_link' and 'unconnected_frame' because they are not part of the same tree. TF has two or more unconnected trees)
</code></pre>
<p>To limit this, a wait function was added: <code>ld.add_action(TimerAction(period=5.0, actions=[rsp_node]))</code> to make sure the transform is published before the rsp_node starts.</p>
<h2 id="figures">Figures</h2>
<p><img alt="My Robot Diagram" src="/resources/humanoid-static_agents-frames.png" />
<em>Figure 1: Humanoid frames visualization</em></p>
<h2 id="rviz2-visualization">Rviz2 visualization</h2>
<p>If you want to visualize the movement in Rviz, you need to configure the <code>config/moveit.rviz</code> file and change all <code>/humanoid_X</code> instances to the namespace you want to visualize.</p>
<h2 id="bugs-tf-visualization-and-gazebo-simulation-not-matching">Bugs: TF visualization and Gazebo simulation not matching</h2>
<p>When visualizing and comparing the actual TF data and simulated locations of the humanoids when doing navigation and teleop, it can be seen that these do not match. This is a major issue since that means the location of where the humanoids think they are in the map and the location of where the humanoids actually are in Gazebo will be different. This can be visualized by turning the humanoid 360 degrees in Gazebo with the <code>./control.sh teleop humanoid_1</code> command and comparing it to Rviz. There, the humanoid has turned closer to 300 degrees.</p>
<p>This problem probably comes from some URDF descriptions not matching the actual geometry or specifications the humanoid has in <code>/home/ros/src/simulation/humanoid_support_moveit_config/config/human_support_wheels.urdf.xacro</code>. By tuning the <code>mass</code>, <code>mu</code>, and <code>inertial</code> values in the <code>&lt;xacro:macro name="wheel" params="wheel_prefix *joint_pose"&gt;</code> xacro tag, it was possible to tune the degree mismatch.</p>
<p>For proper navigation and control, this needs to be fixed!</p>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../humanoid_robot/" class="btn btn-neutral float-left" title="Humanoid Robot"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../../humanoid_utility/" class="btn btn-neutral float-right" title="Humanoid Motion Capture">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../humanoid_robot/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../../humanoid_utility/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "../..";</script>
    <script src="../../js/theme_extra.js"></script>
    <script src="../../js/theme.js"></script>
      <script src="../../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
